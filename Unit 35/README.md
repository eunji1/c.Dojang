# Unit 35. λ©”λ¨λ¦¬ μ‚¬μ©ν•κΈ°


μ΄λ²μ—λ” ν¬μΈν„°μ— μ›ν•λ” λ§νΌ λ©”λ¨λ¦¬ κ³µκ°„μ„ ν• λ‹Ήλ°›μ•„ μ‚¬μ©ν•λ” λ°©λ²•μ„ μ•μ•„λ΄„

λ¨Όμ € λ‹¤μκ³Ό κ°™μ΄ λ©”λ¨λ¦¬λ” malloc -> μ‚¬μ© -> free ν¨ν„΄ μ‚¬μ©ν•λ‹¤.

<details>
<summary>[κ·Έλ¦Ό 35-1] λ©”λ¨λ¦¬ μ‚¬μ© ν¨ν„΄
</summary>
<div markdown="1">       

π

![](https://dojang.io/pluginfile.php/347/mod_page/content/15/unit35-1.png)

</div>
</details>

## 35.1 λ©”λ¨λ¦¬ ν• λ‹Ήν•κΈ°
λ©”λ¨λ¦¬λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ malloc ν•¨μλ΅ μ‚¬μ©ν•  λ©”λ¨λ¦¬ κ³µκ°„μ„ ν™•λ³΄ν•΄μ•Όν•¨

- ν¬μΈν„° = malloc(ν¬κΈ°);
    - void *malloc(size_t _Size);
    - μ„±κ³µν•λ©΄ λ©”λ¨λ¦¬ μ£Όμ†λ¥Ό λ°ν™, μ‹¤ν¨ν•λ©΄ NULLμ„ λ°ν™

```c
#include <stdio.h>
#include <stdlib.h>    // malloc, free ν•¨μκ°€ μ„ μ–Έλ ν—¤λ” νμΌ

int main()
{
    int num1 = 20;    // intν• λ³€μ μ„ μ–Έ
    int *numPtr1;     // intν• ν¬μΈν„° μ„ μ–Έ

    numPtr1 = &num1;  // num1μ λ©”λ¨λ¦¬ μ£Όμ†λ¥Ό κµ¬ν•μ—¬ numPtrμ— ν• λ‹Ή

    int *numPtr2;     // intν• ν¬μΈν„° μ„ μ–Έ

    numPtr2 = malloc(sizeof(int));    // intμ ν¬κΈ° 4λ°”μ΄νΈλ§νΌ λ™μ  λ©”λ¨λ¦¬ ν• λ‹Ή

    printf("%p\n", numPtr1);    // 006BFA60: λ³€μ num1μ λ©”λ¨λ¦¬ μ£Όμ† μ¶λ ¥
                                // μ»΄ν“¨ν„°λ§λ‹¤, μ‹¤ν–‰ν•  λ•λ§λ‹¤ λ‹¬λΌμ§

    printf("%p\n", numPtr2);     // 009659F0: μƒλ΅ ν• λ‹Ήλ λ©”λ¨λ¦¬μ μ£Όμ† μ¶λ ¥
                                // μ»΄ν“¨ν„°λ§λ‹¤, μ‹¤ν–‰ν•  λ•λ§λ‹¤ λ‹¬λΌμ§

    free(numPtr2);    // λ™μ μΌλ΅ ν• λ‹Ήν• λ©”λ¨λ¦¬ ν•΄μ 

    return 0;
}
```


μ—¬κΈ°μ„ numPtr1μ—λ” μΌλ° λ³€μμ λ©”λ¨λ¦¬ μ£Όμ†λ¥Ό ν• λ‹Ήν–κ³ , numPtr2μ—λ” malloc ν•¨μλ΅ λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ήν–μµλ‹λ‹¤.<br>
κ°™μ€ λ©”λ¨λ¦¬ μ£Όμ†λΌλ„ λ‚΄λ¶€μ μΌλ΅λ” μ•½κ°„μ μ°¨μ΄κ°€ μμµλ‹λ‹¤.<br>
μ¤νƒκ³Ό ν™ λ‘κ°€μ§€μΈλ° λ³€μλ” μ¤νƒ(stack)μ— μƒμ„±λλ©° malloc ν•¨μλ” ν™(heap) λ¶€λ¶„μ λ©”λ¨λ¦¬λ¥Ό μ‚¬μ©ν•λ‹¤. (μ¤νƒ, ν™μ μ„μΉμ™€ μ»¤μ§€λ” λ°©ν–¥μ€ μ΄μμ²΄μ  λ° ν”λ«νΌμ— λ”°λΌ λ‹¬λΌμ§ μ μμ)


<details>
<summary>[κ·Έλ¦Ό 35-2] μ¤νƒκ³Ό ν™(Windows x86/32λΉ„νΈ)
</summary>
<div markdown="1">       

π

![](https://dojang.io/pluginfile.php/348/mod_page/content/31/unit35-2.png)

</div>
</details>

μ¤νƒκ³Ό ν™μ ν° μ°¨μ΄μ μ€ λ©”λ¨λ¦¬ ν•΄μ μ΄λ‹¤. μ¤νƒμ— μƒμ„±λ λ³€μλ” μ‚¬μ©ν• λ’¤ λ”°λ΅ μ²λ¦¬λ¥Ό ν•΄μ£Όμ§€ μ•μ•„λ„ λμ§€λ§ malloc ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ ν™μ—μ„ ν• λ‹Ήν• λ©”λ¨λ¦¬λ” λ°λ“μ‹ ν•΄μ λ¥Ό ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤. λ”°λΌμ„ λ‹¤μκ³Ό κ°™μ΄ free ν•¨μλ΅ λ©”λ¨λ¦¬λ¥Ό ν•΄μ ν•λ‹¤.

- free(ν¬μΈν„°);
    - void free(void *_Block);

## 35.2 λ©”λ¨λ¦¬μ— κ°’ μ €μ¥ν•κΈ°
```c
#include <stdio.h>
#include <stdlib.h>    // malloc, free ν•¨μκ°€ μ„ μ–Έλ ν—¤λ” νμΌ

int main()
{
    int *numPtr;    // intν• ν¬μΈν„° μ„ μ–Έ

    numPtr = malloc(sizeof(int));    // intμ ν¬κΈ° 4λ°”μ΄νΈλ§νΌ λ™μ  λ©”λ¨λ¦¬ ν• λ‹Ή

    *numPtr = 10;   // ν¬μΈν„°λ¥Ό μ—­μ°Έμ΅°ν• λ’¤ κ°’ ν• λ‹Ή

    printf("%d\n", *numPtr);    // 10: ν¬μΈν„°λ¥Ό μ—­μ°Έμ΅°ν•μ—¬ λ©”λ¨λ¦¬μ— μ €μ¥λ κ°’ μ¶λ ¥

    free(numPtr);    // λ™μ  λ©”λ¨λ¦¬ ν•΄μ 

    return 0;
}
```

```malloc ν•¨μ```λ΅ ν• λ‹Ήν• λ©”λ¨λ¦¬μ— κ°’μ„ μ €μ¥ν•  λ•λ” *numPtr = 10;μ²λΌ ν¬μΈν„°λ¥Ό μ—­μ°Έμ΅°ν• λ’¤ κ°’μ„ μ €μ¥<br>
λ§μ°¬κ°€μ§€λ΅ printf ν•¨μλ΅ κ°’μ„ μ¶λ ¥ν•  λ•λ„ ν¬μΈν„°λ¥Ό μ—­μ°Έμ΅°ν•μ—¬ κ°’μ„ κ°€μ Έμ΄

λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ήν•κ³  μ‚¬μ©ν• λ’¤μ—λ” λ°λ“μ‹ ```free``` ν•¨μλ΅ ν•΄μ 

## 35.3 λ©”λ¨λ¦¬ λ‚΄μ©μ„ ν•κΊΌλ²μ— μ„¤μ •ν•κΈ°
- memset(ν¬μΈν„°, μ„¤μ •ν• κ°’, ν¬κΈ°);
    - void *memset(void *_Dst, int _Val, size_t _Size);
    - κ°’ μ„¤μ •μ΄ λλ‚ ν¬μΈν„°λ¥Ό λ°ν™

```c
#include <stdio.h>
#include <stdlib.h>    // malloc, free ν•¨μκ°€ μ„ μ–Έλ ν—¤λ” νμΌ
#include <string.h>    // memset ν•¨μκ°€ μ„ μ–Έλ ν—¤λ” νμΌ

int main()
{
    long long *numPtr = malloc(sizeof(long long));  // long longμ ν¬κΈ° 8λ°”μ΄νΈλ§νΌ λ™μ  λ©”λ¨λ¦¬ ν• λ‹Ή

    memset(numPtr, 0x27, 8);    // numPtrμ΄ κ°€λ¦¬ν‚¤λ” λ©”λ¨λ¦¬λ¥Ό 8λ°”μ΄νΈλ§νΌ 0x27λ΅ μ„¤μ •

    printf("0x%llx\n", *numPtr);    // 0x2727272727272727: 27μ΄ 8κ° λ“¤μ–΄κ°€ μμ

    free(numPtr);    // λ™μ μΌλ΅ ν• λ‹Ήν• λ©”λ¨λ¦¬ ν•΄μ 

    return 0;
}
```
μ—¬κΈ°μ„λ” ```memset(numPtr, 0x27, 8);```κ³Ό κ°™μ΄ μ‚¬μ©ν–μΌλ―€λ΅ numPtrμ΄ κ°€λ¦¬ν‚¤λ” λ©”λ¨λ¦¬μ—λ” 16μ§„μ 27μ΄ 8κ° λ“¤μ–΄κ°€κ² λ©λ‹λ‹¤.

memset ν•¨μλ” μ£Όλ΅ λ‹¤μκ³Ό κ°™μ΄ μ„¤μ •ν•  κ°’μ„ 0μΌλ΅ μ§€μ •ν•μ—¬ λ©”λ¨λ¦¬μ λ‚΄μ©μ„ λ¨λ‘ 0μΌλ΅ λ§λ“¤ λ• μ£Όλ΅ μ‚¬μ©ν•©λ‹λ‹¤.
```c
memset(numPtr, 0, 8);    // numPtrμ΄ κ°€λ¦¬ν‚¤λ” λ©”λ¨λ¦¬λ¥Ό 8λ°”μ΄νΈλ§νΌ 0μΌλ΅ μ„¤μ •
```

## 35.4 λ„ ν¬μΈν„° μ‚¬μ©ν•κΈ°
```c
#include <stdio.h>

int main()
{
    int *numPtr1 = NULL;    // ν¬μΈν„°μ— NULL μ €μ¥

    printf("%p\n", numPtr1);    // 00000000

    return 0;
}
```
NULLμ΄ λ“¤μ–΄μλ” ν¬μΈν„°λ¥Ό λ„ ν¬μΈν„°(null pointer)λΌκ³  ν•λ©° μ•„λ¬΄κ²ƒλ„ κ°€λ¦¬ν‚¤μ§€ μ•λ” μƒνƒλ¥Ό λ»